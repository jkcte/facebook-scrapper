;/*FB_PKG_DELIM*/

__d("MAWEncryptedBackupsUpdateGlobalRestoreStatus",["WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Set(),j=new Set();function k(a){if(a==="restore")return i;else return j}function a(a,b){b=k(b);b.add(a)}function b(a,b){b=k(b);b.has(a)?b["delete"](a):d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Thread with thread id "," is not currently being tracked, but restore seems to be in progress"])),a)}function c(a){a=k(a);return a.size}g.addThreadIdToStatusArray=a;g.removeThreadIdFromStatusArray=b;g.getCurrentGlobalRestoreStatusArrayLength=c}),98);
__d("MAWRestoreMessagesFromEncryptedBackupsNOP",["EBLogger","ExecutionEnvironment","I64","LSDataTraceCheckPoint","LSIntEnum","LSMEBTaskCreationSource","MAWAsyncEBPendingQueryPromise","MAWBridgeTraceRecordCheckpointHandler","MAWBridgeUpdateClientRestoreStatus","MAWChatJid","MAWEBRestoreTrackingUtils","MAWEncryptedBackupsUpdateGlobalRestoreStatus","MAWJobDefinitions","MAWJobManager","MAWOfflineQueueStatus","MAWTimedJob","MAWUpdateClientRestoreStatusOperationType","Promise","ReQL","WAJobOrchestratorTypes","WATagsLogger","asyncToGeneratorRuntime","cr:4992","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p;function q(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){try{c=(yield d("MAWChatJid").toThreadKeyMaybeForChatJidInteger(a,(p||(p=d("I64"))).of_string(c)));if(c!=null){a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.messages_ranges_v2__generated).getKeyRange(c)));if(a!=null)return a.minMessageId}}catch(a){return(n||(n=b("Promise"))).reject(a)}return});return r.apply(this,arguments)}function s(a,b,c){if(b===0)return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.mi_act_mapping_table)).then(function(a){a.forEach(function(a){a=d("MAWJobDefinitions").toThreadJidPrimaryId((p||(p=d("I64"))).to_string(a.jid));d("MAWEncryptedBackupsUpdateGlobalRestoreStatus").addThreadIdToStatusArray(a,"restore");c&&d("MAWEncryptedBackupsUpdateGlobalRestoreStatus").addThreadIdToStatusArray(a,"ebprefetch")})})}function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,m,r,t,v,w,x,y,z,A,B,C){B===void 0&&(B=d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION);d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",x!=null?x:""]).LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][","] Received echo documents for thread: "," startSortKey: "," messagesCount: ",""])),x!=null?x:"",f,y,g.length);C=(yield d("MAWChatJid").toThreadKeyMaybeForChatJidInteger(a,(p||(p=d("I64"))).of_string(f)));C==null&&d("EBLogger").EBLogger().MUSTFIX(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to get thread key for "," when calling restoreMessagesFromEncryptedBackup"])),f);C=!d("MAWOfflineQueueStatus").isOfflineQueueComplete()&&b("cr:4992")!=null&&y==null&&f!=null;var D=d("MAWEncryptedBackupsUpdateGlobalRestoreStatus").getCurrentGlobalRestoreStatusArrayLength("restore");yield s(a,D,C);try{D=(yield q(a,f));if(C&&b("cr:4992")!=null){d("WATagsLogger").TAGS(["labyrinth_web","eb_prefetch",x!=null?x:""]).LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Calling prefetch for thread ",""])),f);d("MAWEBRestoreTrackingUtils").markEBRestoreFrontloaded(z,x);C={action:d("MAWUpdateClientRestoreStatusOperationType").upsertClientRestoreStatus,threadId:f};yield d("MAWBridgeUpdateClientRestoreStatus").call(a,C);yield b("cr:4992")(a,e,f,g,m,r,t,v,w,x,y,D,z,A,B)}else{d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",x!=null?x:""]).LOG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Calling worker job for thread "," StartSortKey: "," messagesCount: ",""])),f,y,g.length);return u(e,f,g,D,m,t,w,x,y,z,A,B).then(function(){x!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"native_op_end",traceId:x})})}}catch(e){d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",x!=null?x:""]).ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to restore messages for thread "," with error: ",""])),f,e);return x!=null?d("MAWBridgeTraceRecordCheckpointHandler").call(a,{checkPointId:(o||(o=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_FOR_FAILURE),dataTraceId:x,errorMessage:e,shouldFlush:!0,syncChannel:-1,tags:void 0}).then(function(){return(n||(n=b("Promise"))).reject(e)}):(n||(n=b("Promise"))).reject(e)}});return t.apply(this,arguments)}function u(a,e,f,g,h,i,j,k,l,o,p,q){var r=(m||(m=c("ExecutionEnvironment"))).isInWorker?d("MAWJobManager").getJobManager():d("MAWTimedJob").TimedUIJobStarters;if(k!=null&&o===c("LSMEBTaskCreationSource").MESSENGER_MESSAGE_LIST_PAGINATION)return r.waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.restoreMessagesFromEncryptedBackups(a,e,f,h,i,j,g!=null?g:void 0,k!=null?k:void 0,l!=null?l:void 0,void 0,void 0,o,{priority:q},p)).then(function(a){if(a.success===!0)d("MAWAsyncEBPendingQueryPromise").resolvePendingQueryUponReStore(k);else{var b;d("MAWAsyncEBPendingQueryPromise").rejectPendingQueryIfPresent(k,(b=a.payload)!=null?b:c("err")(a.error))}});return o===c("LSMEBTaskCreationSource").MEDIA_GALLERY_RESTORE?r.waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.restoreMessagesFromEncryptedBackups(a,e,f,h,i,j,g!=null?g:void 0,k!=null?k:void 0,l!=null?l:void 0,void 0,void 0,o,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},p)).then(function(){return(n||(n=b("Promise"))).resolve()}):(n||(n=b("Promise"))).resolve(r.fireAndForget(d("MAWJobDefinitions").jobSerializers.restoreMessagesFromEncryptedBackups(a,e,f,h,i,j,g!=null?g:void 0,k!=null?k:void 0,l!=null?l:void 0,void 0,void 0,o,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},p)))}g.call=a}),98);
__d("useMAWSecretConversationsLogOut",["MAWSecretConversationsLogout","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useCallback;function a(a){var b=d("react-compiler-runtime").c(2),e;b[0]!==a?(e=function(){return c("MAWSecretConversationsLogout")(a)},b[0]=a,b[1]=e):e=b[1];return e}g["default"]=a}),98);